{% extends 'base.html' %}
{% load static %}
{% block content %}

<div class="flex justify-center items-center h-screen w-screen">
    <div class="items-start block">
        <div id="buttons-menu" class="mb-1 flex justify-between">
            <a href="" class="bg-red-700 text-white font-bold rounded p-1">Pomológio</a>
            <a href="" class="bg-red-700 text-white font-bold rounded p-1">Configurações</a>
            <a href="" class="bg-red-700 text-white font-bold rounded py-1 px-8">Perfil</a>
        </div>
        <div id="buttons-pomodoro" class="border-4 px-4 pb-16 pt-4 bg-red-500">
            <div class="flex items-start">
                <button onclick="pomodoroFunc()" class="border-2 mr-2 text-white font-bold rounded p-1">Pomodoro</button>
                <button onclick="shortBreakFunc()" class="border-2 text-white font-bold rounded p-1">Descanso curto</button>
                <button onclick="longBreakFunc()" class="border-2 ml-2 text-white font-bold rounded p-1">Descanso longo</button>
            </div>
            <div class="flex justify-center items-center">
                <span id="clock-minutes" class="mt-16 text-6xl text-white font-bold">00</span>
                <span class="mt-16 text-6xl text-white font-bold">:</span>
                <span id="clock-seconds" class="mt-16 text-6xl text-white font-bold">05</span>
            </div>
            <div class="flex justify-center items center">
                <button id="start-button" onclick="disableButton(); startCouting(); enableButton();"
                    class="mt-8 border-2 rounded py-1 px-4 text-white font-bold">Iniciar</button>
            </div>
        </div>
    </div>
</div>

<script>
    var isTiking = false;
    var minutesElement = document.getElementById("clock-minutes");
    var secondsElement = document.getElementById("clock-seconds");

    function couting(minutes, seconds, minutesElement, secondsElement) {
        seconds -= 1;
        if (seconds < 0) {
            seconds = 59
            minutes -= 1;
        }

        minutesElement.textContent = minutes.toLocaleString('pt-BR', { minimumIntegerDigits: 2 })
        secondsElement.textContent = seconds.toLocaleString('pt-BR', { minimumIntegerDigits: 2 });
        if (minutes == 0 && seconds == 0) {
            isTiking = false;
            switch (activeType) {
            case pomodoro:
                shortBreakFunc();
                break;
            case shortBreak:
                pomodoroFunc();
                break;
            case longBreak:
                pomodoroFunc();
                break;
            }
        }
    }

    function defineTime(){
        defineButtonString();
        switch (activeType) {
            case pomodoro:
            minutesElement.textContent = "25";
                break;
            case shortBreak:
                minutesElement.textContent = "05";
                break;
            case longBreak:
                minutesElement.textContent = "15";
                break;
        }
        secondsElement.textContent = "00";
    }

    function defineButtonString(){
        document.getElementById("start-button").textContent = isTiking ? "Pausar" : "Iniciar";
    }

    const pomodoro = Symbol("pomodoro");
    const shortBreak = Symbol("shortBreak");
    const longBreak = Symbol("longBreak");
    var activeType = pomodoro;
    
    async function startCouting() {
        isTiking = !isTiking;
        defineButtonString();

        while (isTiking) {
            minutesElement = document.getElementById("clock-minutes");
            secondsElement = document.getElementById("clock-seconds");
            var minutes = parseInt(minutesElement.textContent);
            var seconds = parseInt(secondsElement.textContent);

            couting(minutes, seconds, minutesElement, secondsElement);
            console.log("Entrou")
            await new Promise(r => setTimeout(r, 1000));   
        }
        
    }

    function disableButton(){
        document.getElementById('start-button').disabled = true;
    }

    async function enableButton(){
        await new Promise(r => setTimeout(r, 1000)); 
        document.getElementById('start-button').disabled = false;
    }

    function pomodoroFunc() {
        isTiking = false;
        activeType = pomodoro
        defineTime();    
        document.getElementById("buttons-pomodoro").className = "border-4 px-4 pb-16 pt-4 bg-red-500";
    }

    function shortBreakFunc() {
        isTiking = false;
        activeType = shortBreak
        defineTime();
        document.getElementById("buttons-pomodoro").className = "border-4 px-4 pb-16 pt-4 bg-blue-500";
    }

    function longBreakFunc() {
        isTiking = false;
        activeType = longBreak
        defineTime();
        document.getElementById("buttons-pomodoro").className = "border-4 px-4 pb-16 pt-4 bg-blue-800";
    }
</script>

{% endblock %}